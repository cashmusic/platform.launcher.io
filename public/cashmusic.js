/**
 * The core script for public-facing CASH Music elements and embeds
 * http://cashmusic.org/ 
 *
 * License: BSD, included in uncompressed source
 * Source: https://raw.github.com/cashmusic/platform/master/interfaces/php/public/cashmusic_uncompressed.js
 */
window.cashmusic=(function(){var a;if(window.cashmusic!=null){a=window.cashmusic;}else{a={getXHR:function(){try{return new XMLHttpRequest();}catch(c){try{return new ActiveXObject("Msxml2.XMLHTTP");}catch(d){try{return new ActiveXObject("Microsoft.XMLHTTP");}catch(b){return false;}}}},embed:function(e,h,d,f){var c="cashmusic_embed"+Math.floor((Math.random()*1000000)+1);var j=e+"/request/embed/"+h+"/location/"+encodeURIComponent(window.location.href.replace(/\//g,"!slash!"));if(d){if(!f){f="open element";}var g="cashmusic_embed"+Math.floor((Math.random()*1000000)+1);document.write('<a id="'+c+'" href="'+j+'" target="_blank">'+f+'</a><div id="'+g+'" style="position:fixed;overflow:auto;top:0;left:0;width:100%;height:100%;background-color:rgba(80,80,80,0.85);opacity:0;display:none;z-index:654321;"><div style="position:absolute;top:80px;left:50%;margin-left:-260px;z-index:10;background-color:#fff;padding:10px;"><iframe src="'+j+'" scrolling="auto" width="500" height="400" frameborder="0"></iframe></div></div>');var i=(function(){return{init:function(o,m,n){this.elem=document.getElementById(o);clearInterval(this.elem.si);this.target=n?n:m?100:0;this.flag=m||-1;this.alpha=this.elem.style.opacity?parseFloat(this.elem.style.opacity)*100:0;if(this.alpha==0&&n>0){this.elem.style.display="block";}this.si=setInterval(function(){i.tween();},20);},tween:function(){if(this.alpha==this.target){clearInterval(this.elem.si);}else{var m=Math.round(this.alpha+((this.target-this.alpha)*0.05))+(this.flag);this.elem.style.opacity=m/100;this.elem.style.filter="alpha(opacity="+m+")";if(m==0){this.elem.style.display="none";}this.alpha=m;}}};}());document.getElementById(c).addEventListener("click",function(m){i.init(g,1,100);m.preventDefault();},false);window.addEventListener("keyup",function(m){if(m.keyCode==27){i.init(g,0);}},false);}else{var l='<iframe id="'+c+'" src="'+j+'" scrolling="auto" width="100%" height="1" frameborder="0"></iframe><!--[if lte IE 7]><script type="text/javascript">var iframeEmbed=document.getElementById("'+c+'");iframeEmbed.height = "400px";<\/script><![endif]-->';document.write(l);var k=document.getElementById(c);var b=function(m){if(j.indexOf(m.origin)!==-1){k.height=m.data+"px";if(window.addEventListener){window.removeEventListener("message",b,false);}else{if(window.attachEvent){window.detachEvent("onmessage",b);}}}};if(window.addEventListener){window.addEventListener("message",b,false);}else{if(window.attachEvent){window.attachEvent("onmessage",b);}}}},encodeForm:function(d){if(typeof d!=="object"){return false;}var b="";d=d.elements||d;for(var c=0;c<d.length;c++){if(d[c].type==="checkbox"||d[c].type==="radio"){if(d[c].checked){b+=(b.length?"&":"")+d[c].name+"="+d[c].value;}continue;}b+=(b.length?"&":"")+d[c].name+"="+d[c].value;}return encodeURI(b);},sendXHR:function(c,d,b){var f="POST";if(!d){f="GET";d=null;}var e=this.getXHR();if(e){e.open(f,c,true);e.setRequestHeader("X-Requested-With","XMLHttpRequest");if(f=="POST"){e.setRequestHeader("Content-type","application/x-www-form-urlencoded");}if(typeof b=="function"){e.onreadystatechange=function(){if(e.readyState===4&&e.status===200){b(e.responseText);}};}e.send(d);}}};}return a;}());